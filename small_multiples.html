<!DOCTYPE html>

<!--
Adam Rule
02.16.2015

Webpage showing screenshots and video for AEC study

Helpful Websites
http://stackoverflow.com/questions/13595113/html-javascript-iterate-through-all-elements-of-local-server-side-folder
http://stackoverflow.com/questions/20030162/getting-data-attribute-for-onclick-event-for-an-html-element
-->

<head>
    <title>Multiples</title>
    <meta charset="utf-8">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="style.css">

    <script src="//code.jquery.com/jquery-1.9.1.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

</head>

<body onload="callForImages()">

    <div id="header">
        <h1>Activity Visualizer</h1>

        <hr>
        <div id="myForm">
            <input type="radio" value="dayview" name="radio"><label for="radio1">Day</label>
            <input type="radio" value="weekview" name="radio"><label for="radio2">Week</label>
            <input type="radio" value="small_multiples" name="radio" checked="checked"><label for="radio3">Small multiples</label>
        </div>
<hr>

        <div class="slider-block">
            <p id='sizeText'>Thumbnail Size: 100</p>
            <div id='windowSize'></div>
        </div>

        <div class="slider-block">
            <p id='numImageText'># of images: 20</p>
            <div id='numOfImages'></div>
        </div>

    </div>

    <div id="images"></div>

    <!-- Main script to display images -->
    <script language="javascript" type="text/javascript">

        var img_data = []

        // starting image size
        imgW = 100;
        imgH = 100;

        //Makes an asynchronous request, loading the getimages.php file
        function callForImages() {

            //Create the request object
            var httpReq = (window.XMLHttpRequest)?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");

            //When it loads,
            httpReq.onload = function() {

                //Convert the result back into JSON
                var result = JSON.parse(httpReq.responseText);
                // var img_data = [];
                for(var i = 0; i < result.length; i++){
                    var filename_elements = result[i].split("_");
                    var x = filename_elements[1];
                    var y = filename_elements[2].split(".")[0];
                    img_data.push([result[i], x, y]);
                }

                //Show the images
                loadImages(img_data);
            }

            //Request the page
            try {
                httpReq.open("GET", "small_multiples.php", true);
                httpReq.send(null);
            } catch(e) {
                console.log(e);
            }
        }

        //Generates the images and sticks them in the container
        function loadImages(images) {

            // only grab 20 images
            var reduced_images = [];
            var jump_by = parseInt(images.length/20)
            for(var i = 0; i < images.length; i=i+jump_by) {
                    reduced_images.push(images[i]);
            }

            // add images to page in a div used for cropping
            d3.select('#images').selectAll('div')
                .data(reduced_images)
                .enter().append('div')
                .attr('class', 'clickDiv')
                .append('img')
                    .attr('class', 'clickImg')
                    .style('top', function(d){return -d[2] + imgH/2 + 'px'})
                    .style('left', function(d){return  -d[1] + imgW/2 + 'px'})
                    .attr('src', function(d){return d[0]});

            // resize and reposition images on change of image size
            $("#windowSize").slider({max:800},{min:50},{value:100},{slide: function( event, ui ) {
                d3.selectAll('.clickDiv')
                    .style('width', function(){return ui.value+'px'})
                    .style('height', function(){return ui.value+'px'})
                    .selectAll('.clickImg')
                        .style('top', function(d){return -d[2] + ui.value/2 + 'px'})
                        .style('left', function(d){return  -d[1] + ui.value/2 + 'px'});

                document.getElementById('sizeText').innerHTML = 'Thumbnail Size: ' + ui.value;
                imgW = ui.value;
                imgH = ui.value;
            }});

            $("#numOfImages").slider({max:100},{min:10},{step:5},{value:20},{slide: function( event, ui ) {
                var reduced_images = [];
                var jump_by = parseInt(img_data.length/ui.value)
                for(var i = 0; i < img_data.length; i=i+jump_by) {
                        reduced_images.push(img_data[i]);
                }

                multiples = d3.select('#images').selectAll('.clickDiv')
                    .data([]);

                multiples.exit().remove();

                multiples = d3.select('#images').selectAll('img')
                    .data(reduced_images);

                multiples.enter().append('div')
                    .attr('class', 'clickDiv')
                    .append('img')
                        .attr('class', 'clickImg')
                        .style('top', function(d){return -d[2] + imgH/2 + 'px'})
                        .style('left', function(d){return  -d[1] + imgW/2 + 'px'})
                        .attr('src', function(d){return d[0]});

                multiples.exit().remove();

                document.getElementById('numImageText').innerHTML = '# of images: ' + ui.value;
            }});
			
			$('#myForm input').on('change', function() {
			        if ($('input[name=radio]:checked', '#myForm').val() == "dayview"){
			            window.location.href = "index.html";
			        }
			        if ($('input[name=radio]:checked', '#myForm').val() == "weekview"){
			            window.location.href = "index.html";
			        }
			    });

        }

    </script>

</body>

</html>
